버전: v1.0.0
작성일: 2025-11-05
백엔드: Node.js(Express) + Prisma(MySQL)
통신 프로토콜: REST(React 앱) / MQTT(아두이노 센서)


회원인증
| 메서드 | 경로               | 요청 Body                                    | 응답                       | 설명           
| ------ | ------------------ | -------------------------------------------- | -------------------------- | ------------ 
| `POST` | `/api/auth/signup` | `{ "email": "user@mail.com", "pw": "1234" }` | `{ "user_id": 1 }`         | 회원가입         
| `POST` | `/api/auth/login`  | `{ "email": "user@mail.com", "pw": "1234" }` | `{ "token": "JWT_TOKEN" }` | 로그인 (JWT 반환) 


사용자 정보
| 메서드| 경로                 | 요청                                | 응답                                                             | 설명        
| ----- | -------------------- | ----------------------------------- | ---------------------------------------------------------------- | --------- 
| `GET` | `/api/users/me`      | 헤더: `Authorization: Bearer {token}` | `{ "id":1, "email":"user@mail.com", "lat":37.56, "lon":126.97 }` | 사용자 정보 조회 
| `PUT` | `/api/users/address` | `{ "lat": 37.56, "lon": 126.97 }`   | `{ "ok": true }`                                                 | 주소/좌표 저장  


개인알람
| 메서드 | 경로                | 요청                     | 응답                                     | 설명        |
| ------ | ------------------- | ------------------------ | ---------------------------------------- | --------- |
| `POST` | `/api/users/alarms` | `{ "alarm_text": "차키" }` | `{ "alarm_id": 3 }`                     | 알람 추가     |
| `GET`  | `/api/users/alarms` | -                        | `{ "alarms": [{ "id":1,"text":"차키" }] }`| 등록된 알람 목록 |


디바이스 관리
| 메서드 | 경로        | 요청                                                                                      | 응답                                                       | 설명        |
| ------ | -------------- | -------------------------------------------------------------------------------------- | ---------------------------------------------------------- | --------- |
| `POST` | `/api/devices` | `{ "user_id":1, "type":"UMBRELLA_BIN", "name":"main_box", "secret":"dev_device_key" }` | `{ "device_id":2 }`                                        | 장치 등록     |
| `GET`  | `/api/devices` | -                                                                                      | `[ { "id":2, "type":"UMBRELLA_BIN", "name":"main_box" } ]` | 등록된 장치 목록 |

| 메서드 | 경로                       | 요청                              | 응답                                                      | 설명               |
| ------ | -------------------------- | --------------------------------- | --------------------------------------------------------- | ---------------- |
| `POST` | `/api/weather/door-sensed` | `{ "user_id":1, "sensor_id":10 }` | `{ "rain_time":"14:00", "voice_msg":"오늘 14시부터 비가 옵니다." }` | 도어 감지 이벤트 수동 테스트 |
| `GET`  | `/api/bins/status`         | `?device_id=2`                    | `{ "remain":3, "cap":5, "is_open":false }`                | 우산함 상태 조회        |


| 토픽                        | 페이로드                                                     | 설명        |
| ------------------------- | -------------------------------------------------------- | --------- |
| `door/{sensor_id}/sensed` | `{ "user_id":1, "sensor_id":10, "ts":1730800000 }`       | 도어 감지 이벤트 |
| `bin/{device_id}/status`  | `{ "device_id":2, "remain":3, "cap":5, "is_open":true }` | 우산함 상태 보고 |


| 토픽                        | 페이로드                                          | 설명        |
| ------------------------- | --------------------------------------------- | --------- |
| `speaker/{device_id}/cmd` | `{ "type":"tts", "text":"오늘 14시부터 비가 옵니다." }` | 스피커 음성 명령 |
| `box/{device_id}/cmd`     | `{ "act":"open", "close_in":10000 }`          | 우산함 개폐 명령 |



| 항목     | 값                      |
| -------- | ----------------------- |
| Broker   | `mqtt://localhost:1883` |
| QoS      | 1                       |
| Retain   | false                   |
| Username | `smartdoor_mqtt`        |
| Password | `smartdoor_mqtt_pw`     |



| 구분   | 방식  | 헤더/필드                           | 설명           |
| ---- | --- | ------------------------------- | ------------ |
| 사용자  | JWT | `Authorization: Bearer {token}` | 앱 로그인 후      |
| 디바이스 | 공유키 | `"secret":"dev_device_key"`     | MQTT/REST 공통 |



| 코드  | 의미                     |
| --- | ---------------------- |
| 200 | OK                     |
| 201 | Created                |
| 400 | Validation Error       |
| 401 | Unauthorized (JWT 오류)  |
| 403 | Forbidden (Secret 불일치) |
| 404 | Not Found              |
| 500 | Internal Server Error  |

